// Test #09. Add approved signatures: basic checks.


"test-00-header.fif" include


"EQD8YZxRk1uxBKkxlcXjgk5zQkXAx-xYDzpsh4SS49e7geHV" dup =: collection_address $>smca 0= abort"bad address"
=: collection_flags
=: collection_addr
=: collection_wc

"EQAWYHnDf8qmG9mC1CGD1Svf9_9OjWpDgL9EU2fgsTrfH5jG" dup =: owner_address $>smca 0= abort"bad address"
=: owner_flags
=: owner_addr
=: owner_wc

"EQDK-Qt00761ArsHAK5MevbckLBxyHMmjpUEJ4cHWMKOYsZB" dup =: provider_address $>smca 0= abort"bad address"
=: provider_flags
=: provider_addr
=: provider_wc

"EQART9XH37phxxDoNGmcKc7t9AS4iR76HPj2Oj0dgSY824RZ" dup =: other_address $>smca 0= abort"bad address"
=: other_flags
=: other_addr
=: other_wc

"EQCv4tjf-7E9V42WMlRYVPsHtjfiMv3l3-jk4CyE8dz5ReFi" dup =: signee_address $>smca 0= abort"bad address"
=: signee_flags
=: signee_addr
=: signee_wc


<b
   3 64 u, // index
   b{100} s, collection_wc 8 i, collection_addr 256 u, // collection address
   b{100} s, owner_wc 8 i, owner_addr 256 u, // owner address
   <b 7 3 u, b> ref, // content
   <b
      10 8 u,           // sign_max_number
      0 8 u,            // sign_number
       500000000 Gram,  // sign_deploy_fee
      1500000000 Gram,  // sign_commit_fee
      9000000000 Gram,  // min_stake
      b{100} s, provider_wc 8 i, provider_addr 256 u, // sign_provider_address
      sign_request_code s>c ref, // sign_request_code
      dictnew dict,     // signatures
   b> ref,
b> =: init_state


// ------------------------ Case 1: Wrong sender - not a request address ----------------------

<b
   b{0100} s,  // flags: int_msg_info, ihr_disabled, bounce, bounced
   b{100} s, other_wc 8 i, other_addr 256 u,  // sender address
   b{00} s, // dst
   0 Gram,  // value
   b{0} s,    // extra currency
   0 Gram,  // ihr_fee
   0 Gram,  // fwd_fee
b> =: in_msg_full

<b
   0x14D 32 u,   // op code
   0 64 u,       // query_id
   b{100} s, signee_wc 8 i, signee_addr 256 u, // wanted signee address
   1 1 u,        // init 
   1 1 u,        // signed 
b> <s =: in_msg_body

my_balance
msg_value
in_msg_full
in_msg_body
recv_internal 
code
init_state
c7 
runvmctx 

=: state
=: exit_code

exit_code 430 "Wrong exit code" ASSERT_EQUAL_INTS

